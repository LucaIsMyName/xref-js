!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Xref=e()}(this,(function(){"use strict";class t{constructor(t,e){this.cache=new Map,this.options=t,this.xrefOptions=e,this.init()}init(){this.options.active&&document.addEventListener(this.options.event||"mouseover",this.handleEvent.bind(this))}handleEvent(t){const e=t.target.closest(this.options.selector||"a");e&&this.shouldPrefetch(e)&&setTimeout((()=>this.prefetch(e.href)),this.options.delay||100)}shouldPrefetch(t){return!(!t.href||!t.href.startsWith(window.location.origin)||t.href===window.location.href||this.cache.has(t.href))}async prefetch(t){try{const e=await fetch(t),i=await e.text();this.cache.set(t,i),this.xrefOptions.debug&&console.log(`Prefetched: ${t}`)}catch(e){this.xrefOptions.debug&&console.error("Failed to prefetch:"+t,e)}}getContent(t){return this.cache.get(t)||null}}class e{constructor(t={}){var e;this.transitionCounter=0,this.prefetcher=null,this.currentKeyframeName=null,this.options=Object.assign({updateHead:!0},t),this.styleElement=document.createElement("style"),this.styleElement.setAttribute("data-xref","true"),document.head.appendChild(this.styleElement),this.animationState=Object.assign({started:!1,playing:!0,paused:!1,finished:!1},null===(e=this.options.transition)||void 0===e?void 0:e.state),this.init()}init(){var e,i;this.options.debug&&console.log("started -> init() Method"),this.interceptClicks(),this.handlePopState(),this.options.prefetch&&this.options.prefetch.active&&(this.prefetcher=(e=this.options.prefetch,i=this.options,new t(e,i)))}createKeyframes(t,e){const{from:i,to:n}=t,o=`xref-${e}-${++this.transitionCounter}`;let s=`@keyframes ${o} {\n      from {\n        ${Object.entries(i||{}).map((([t,e])=>`${this.camelToKebab(t)}: ${e};`)).join(" ")}\n      }\n      to {\n        ${Object.entries(n||{}).map((([t,e])=>`${this.camelToKebab(t)}: ${e};`)).join(" ")}\n      }\n    }`;return this.options.debug&&console.log("Creating keyframe:"+o),this.options.debug&&console.log("Keyframe CSS:"+s),this.currentKeyframeName&&this.removeKeyframes(this.currentKeyframeName),this.styleElement.textContent=s,this.currentKeyframeName=o,this.options.debug&&console.log("Keyframe "+o+"appended to <style> element"),this.options.debug&&console.log("Current <style> content: "+this.styleElement.textContent),o}removeKeyframes(t){this.options.debug&&console.log("Removing keyframe: "+t),this.styleElement.textContent="",this.options.debug&&console.log("Keyframe"+t+"removed"),this.options.debug&&console.log("Current <style> content after removal:"+this.styleElement.textContent),this.currentKeyframeName=null}interceptClicks(){this.options.debug&&console.log("started -> interceptClicks() Method"),document.addEventListener("click",(t=>{const e=t.target.closest("a");e&&this.shouldIntercept(e)&&(t.preventDefault(),this.runCallback("onEnter"),this.navigate(e.href))}))}shouldIntercept(t){this.options.debug&&console.log("started -> shouldIntercept() Method");const e=new URL(window.location.href),i=new URL(t.href),n=i.origin===e.origin,o=i.pathname===e.pathname&&i.search===e.search,s=o&&i.hash!==e.hash;return n&&!o&&!s}handlePopState(){this.options.debug&&console.log("started -> handlePopState() Method"),window.addEventListener("popstate",(()=>{this.navigate(window.location.href,!1)}))}async navigate(t,e=!0){this.options.debug&&console.log("started -> navigate() Method");try{let i=null;this.prefetcher&&(i=this.prefetcher.getContent(t)),i||(i=await this.fetchPage(t)),i&&(e&&history.pushState(null,"",t),this.updatePage(i))}catch(t){this.options.debug&&console.error("Navigation failed:",t)}}async fetchPage(t){this.options.debug&&console.log("started -> fetchPage() Method");const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.text()}updatePage(t){this.options.debug&&console.log("started -> updatePage() Method");const e=(new DOMParser).parseFromString(t,"text/html");this.updateHead(e),this.updateBody(e)}updateHead(t){this.options.debug&&console.log("started -> updateHead() Method");const e=document.head,i=t.head;document.title=t.title,!1!==this.options.updateHead&&(Array.from(e.children).forEach((t=>{t!==this.styleElement&&"TITLE"!==t.tagName&&t.remove()})),Array.from(i.children).forEach((t=>{"STYLE"!==t.tagName&&"TITLE"!==t.tagName&&e.appendChild(t.cloneNode(!0))})),this.options.debug&&console.log("Head updated, xref style element preserved"))}updateBody(t){var e;this.options.debug&&console.log("started -> updateBody() Method");const i=(null===(e=this.options.transition)||void 0===e?void 0:e.swapHtml)||"body",n=document.querySelector(i),o=t.querySelector(i);n?o?(this.performTransition(n,o),window.scrollTo(0,0)):this.options.debug&&console.error(`New document does not contain element: ${i}`):this.options.debug&&console.error(`Old document does not contain element: ${i}`)}performTransition(t,e){this.options.debug&&console.log("Started performTransition");const i=this.options.transition||{},n=i.duration||300,o=i.delay||0,s=i.easing||"ease-in-out",a=i.timeline||"sequential";let r=i.out,l=i.in;!r&&l?r=this.reverseTransition(l):!l&&r&&(l=this.reverseTransition(r)),this.setTransitionState("started",!0),this.runCallback("onStart"),r&&(this.options.debug&&console.log("Applying out transition"),this.applyTransition(t,r,n,o,s,"out"));const h=()=>{this.options.debug&&console.log("Applying in transition"),t.style.removeProperty("animation"),t.innerHTML=e.innerHTML,Array.from(e.attributes).forEach((e=>{"style"!==e.name&&t.setAttribute(e.name,e.value)})),l&&this.applyTransition(t,l,n,0,s,"in")};"sequential"===a?(this.options.debug&&console.log(`Setting timeout for in transition: ${n+o}ms`),setTimeout(h,n+o)):(this.options.debug&&console.log(`Setting timeout for in transition: ${o}ms (parallel)`),setTimeout(h,o))}reverseTransition(t){return{from:t.to,to:t.from}}applyTransition(t,e,i,n,o,s){const a={easeInOut:"cubic-bezier(0.42, 0, 0.58, 1)",easeIn:"cubic-bezier(0.42, 0, 1, 1)",easeOut:"cubic-bezier(0, 0, 0.58, 1)",linearDegressive:"cubic-bezier(0.25, 0.1, 0.25, 1)",linearProgressive:"cubic-bezier(0.1, 0.25, 1, 0.25)",easeInSine:"cubic-bezier(0.47, 0, 0.745, 0.715)",easeOutSine:"cubic-bezier(0.39, 0.575, 0.565, 1)",easeInOutSine:"cubic-bezier(0.445, 0.05, 0.55, 0.95)",easeInQuad:"cubic-bezier(0.55, 0.085, 0.68, 0.53)",easeOutQuad:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",easeInOutQuad:"cubic-bezier(0.455, 0.03, 0.515, 0.955)",easeInCubic:"cubic-bezier(0.55, 0.055, 0.675, 0.19)",easeOutCubic:"cubic-bezier(0.215, 0.61, 0.355, 1)",easeInOutCubic:"cubic-bezier(0.645, 0.045, 0.355, 1)"};for(const[t,e]of Object.entries(a))o===t&&(o=e);this.options.debug&&console.log(`Applying ${s} transition`);const r=this.createKeyframes(e,s),l=`${r} ${i}ms ${o} ${n}ms forwards`;t.style.setProperty("animation",l),this.options.debug&&console.log("Applied "+s+" animation: "+l),this.options.debug&&console.log("Current element style:",t.style.cssText),t.offsetWidth,this.setTransitionState("playing",!0),this.runCallback("onPlay");const h=()=>{this.options.debug&&console.log(`Animation end event fired for ${s} transition`),t.style.removeProperty("animation"),this.removeKeyframes(r),"in"===s&&Object.entries(e.to||{}).forEach((([e,i])=>{t.style.setProperty(this.camelToKebab(e),i)})),this.options.debug&&console.log("Cleaned up "+s+" animation"),this.options.debug&&console.log("Current element style after cleanup:",t.style.cssText),t.removeEventListener("animationend",h),this.setTransitionState("finished",!0),this.runCallback("onFinish")};t.addEventListener("animationend",h,{once:!0})}setTransitionState(t,e){this.animationState[t]=e}runCallback(t){var e,i;const n=null===(i=null===(e=this.options.transition)||void 0===e?void 0:e.callback)||void 0===i?void 0:i[t];n&&"function"==typeof n&&n()}startTransition(){this.setTransitionState("started",!0),this.setTransitionState("playing",!0),this.setTransitionState("paused",!1),this.setTransitionState("finished",!1),this.runCallback("onStart"),this.runCallback("onPlay")}pauseTransition(){var t;if(this.animationState.playing){this.setTransitionState("playing",!1),this.setTransitionState("paused",!0),this.runCallback("onPause");const e=document.querySelector((null===(t=this.options.transition)||void 0===t?void 0:t.swapHtml)||"body");e&&(e.style.animationPlayState="paused")}}resumeTransition(){var t;if(this.animationState.paused){this.setTransitionState("playing",!0),this.setTransitionState("paused",!1),this.runCallback("onPlay");const e=document.querySelector((null===(t=this.options.transition)||void 0===t?void 0:t.swapHtml)||"body");e&&(e.style.animationPlayState="running")}}finishTransition(){this.setTransitionState("playing",!1),this.setTransitionState("paused",!1),this.setTransitionState("finished",!0),this.runCallback("onFinish")}camelToKebab(t){return t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}}return function(t={}){return new e(t)}}));
//# sourceMappingURL=xref.umd.min.js.map
